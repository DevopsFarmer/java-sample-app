pipeline{
  agent any
  tools {maven 'Maven_CDAC'}
  stages{
    stage('Git Clone'){
      steps{
        git branch: 'main', credentialsId: 'dinesh-github-credentials', url: 'https://github.com/DevopsFarmer/java-sample-app.git'
      }
    }

    stage('Build App'){
      steps{
        sh 'mvn clean install'
      }
    }
    stage('Sonar Scanning'){
      environment {
          scanner = tool 'Sonar'
      }
      steps{
          withSonarQubeEnv('cdac_sonar'){
              sh '''
                  ${scanner}/bin/sonar-scanner -Dsonar.projectKey=CDCJavaApp \
                  -Dsonar.sources=. \
                  -Dsonar.projectName=CDC \
                  -Dsonar.java.binaries=target \
                  -Dsonar.organization=devopsfarm-trainings
              '''
          }
      }
        }
  }
}
